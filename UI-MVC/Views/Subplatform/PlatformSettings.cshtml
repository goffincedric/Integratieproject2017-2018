@{
  ViewBag.Title = "PlatformSettings";
  Layout = "~/Views/Shared/_Layout.cshtml";
}

<main class="main-content bgc-grey-100">
  <div id="mainContent">
    <div class="container-fluid">
      <div style="margin: 10px 0;" class="masonry-item col-md-12">
        <div class="bgc-white p-20 bd">
          <h1 class="h3" style="text-align: center">Beheer Subplatform</h1>
        </div>
      </div>
      <div class="masonry-item col-md-12" style="margin: 10px 0;">
        <div class="bgc-white p-20 bd">
          <h3 class="h4">Platform stats</h3>
          <br />

          <span style="color: #2196f3" class="fsz-sm">
            Totaal aantal users: @Html.Label("Totaal aantal users:", (string)ViewBag.TotalUsers)
          </span>
          <br />
          <span style="color: #2196f3" class="fsz-sm">
            Totaal aantal items: @Html.Label("Totaal aantal items", (string)ViewBag.TotalItems)
          </span>
          <br />
          <span style="color: #2196f3" class="fsz-sm">
            Totaal aantal persons: @Html.Label("Totaal aantal users:", (string)ViewBag.TotalPersons)
          </span>
          <br />
          <span style="color: #2196f3" class="fsz-sm">
            Totaal aantal organisations: @Html.Label("Totaal aantal organisations", (string)ViewBag.TotalOrganisations)
          </span>
          <br />
          <span style="color: #2196f3" class="fsz-sm">
            Totaal aantal themes: @Html.Label("Totaal aantal users:", (string)ViewBag.TotalThemes)
          </span>
          <br />
          <span style="color: #2196f3" class="fsz-sm">
            Totaal aantal keywords: @Html.Label("Totaal aantal keywords", (string)ViewBag.TotalKeywords)
          </span>
        </div>
      </div>
      <br />

      <div class="row">
        <div class="masonry-item col-lg-6 col-md-12" style="margin: 10px 0;">
          <div class="bgc-white p-20 bd" style="min-height: 480px;">
            <h6 style="margin-bottom: 25px" class="h6">Subplatform settings</h6>
            @Html.Action("_SubplatformSetting", "Subplatform")
          </div>
        </div>

        <div class="masonry-item col-lg-6 col-md-12" style="margin: 10px 0;">
          <div class="bgc-white p-20 bd" style="min-height: 480px;">
            <h6 style="margin-bottom: 25px" class="h6">Default images</h6>
            <div class="form-group row">
              <div class="col-sm-4">
                <label>Change site logo</label>
              </div>
              <div class="col-sm-6">
                @using (Html.BeginForm("UploadSiteLogo", "Subplatform", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                  <div class="row">
                    <div class="col-9" style="padding: 0; margin: 0">
                      <div class="fileUpload blue-btn btn width100" style="margin: 0;">
                        <span>Upload a new site logo</span>
                        <input type="file" class="uploadlogo1 uploadlogo" name="file" id="file" />
                      </div>
                    </div>
                    <div class="col-3" style="padding: 0; margin: 0">
                      <button type="submit" style="margin-left: 15px" class="btn btn-primary btn-lg">Save</button>
                    </div>
                  </div>
                }
              </div>
            </div>
            <div class="form-group row">
              <div class="col-sm-4">
                <label>Change default item icon</label>
              </div>
              <div class="col-sm-6">
                @using (Html.BeginForm("UploadDefaultItemLogo", "Subplatform", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                  <div class="row">
                    <div class="col-9" style="padding: 0; margin: 0">
                      <div class="fileUpload blue-btn btn width100" style="margin: 0;">
                        <span>Upload a new item icon</span>
                        <input type="file" class="uploadlogo2 uploadlogo" name="file" id="file" />
                      </div>
                    </div>
                    <div class="col-3" style="padding: 0; margin: 0">
                      <button type="submit" style="margin-left: 15px" class="btn btn-primary btn-lg">Save</button>
                    </div>
                  </div>
                }
              </div>
            </div>
            <div class="form-group row">
              <div class="col-sm-4">
                <label>Change default user icon</label>
              </div>
              <div class="col-sm-6">
                @using (Html.BeginForm("UploadDefaultUserLogo", "Subplatform", FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                  <div class="row">
                    <div class="col-9" style="padding: 0; margin: 0">
                      <div class="fileUpload blue-btn btn width100" style="margin: 0;">
                        <span>Upload a new user icon</span>
                        <input type="file" class="uploadlogo3 uploadlogo" name="file" id="file" />
                      </div>
                    </div>
                    <div class="col-3" style="padding: 0; margin: 0">
                      <button type="submit" style="margin-left: 15px" class="btn btn-primary btn-lg">Save</button>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">

        <div class="masonry-item col-lg-6 col-md-12" style="margin: 10px 0;">
          <div class="bgc-white p-20 bd" style="min-height: 630px;">
            <h6 style="margin-bottom: 25px" class="h6">Sync tools</h6>
            <div class="row">

              <div class="col-6">
                @using (Html.BeginForm("CleanupDB", "Subplatform", FormMethod.Post))
                {
                  if (ViewBag.IsCleaning)
                  {
                    <button type="submit" style="margin: 25px 0;" class="btn btn-primary btn-lg" disabled>Cleanup DB</button>
                    <label>Database is momenteel een cleanup aan het ondergaan...</label>
                  }
                  else
                  {
                    <button type="submit" style="margin: 25px 0;" class="btn btn-primary btn-lg">Cleanup DB</button>
                  }
                }

                @using (Html.BeginForm("Syncronize", "Subplatform", FormMethod.Post))
                {
                  if (ViewBag.IsSyncing)
                  {
                    <button type="submit" style="margin: 25px 0;" class="btn btn-primary btn-lg" disabled>Syncroniseer API</button>
                    <label>Database is momenteel een sync aan het ondergaan...</label>
                  }
                  else
                  {
                    <button type="submit" style="margin: 25px 0;" class="btn btn-primary btn-lg">Syncroniseer API</button>
                  }
                }

                @using (Html.BeginForm("GenerateAlertsManually", "Subplatform", FormMethod.Post))
                {
                  if (ViewBag.IsGeneratingAlerts)
                  {
                    <button type="submit" style="margin: 25px 0" ; class="btn btn-primary btn-lg" disabled>Generate alerts manually</button>
                    <label>Er worden momenteel alerts gegenerated door de site...</label>
                  }
                  else
                  {
                    <button type="submit" style="margin: 25px 0" ; class="btn btn-primary btn-lg">Generate alerts manually</button>
                  }
                }

                @using (Html.BeginForm("SendWeeklyReviews", "Subplatform", FormMethod.Post))
                {
                  if (ViewBag.IsSendingWeeklyReviews)
                  {
                    <button type="submit" style="margin: 25px 0;" class="btn btn-primary btn-lg" disabled>Send Weekly Reviews</button>
                    <label>Er worden momenteel weekly reviews verstuurd door de site...</label>
                  }
                  else
                  {
                    <button type="submit" style="margin: 25px 0;" class="btn btn-primary btn-lg">Send Weekly Reviews</button>
                  }
                }
              </div>
              @if (User.IsInRole("SuperAdmin"))
              {
                <div class="col-6">
                  @Html.Action("_SeedIntervals", "Subplatform")
                </div>
              }
            </div>
          </div>
        </div>

        @if (User.IsInRole("SuperAdmin"))
        {
          <div class="masonry-item col-lg-6 col-md-12" style="margin: 10px 0;">
            <div class="bgc-white p-20 bd" style="min-height: 630px;">
              <h6 style="margin-bottom: 25px" class="h6">Deploy new subplatform</h6>
              @Html.Action("_DeploySubplatform", "Subplatform")
              <h6 style="margin-bottom: 25px" class="h6">Active subplatforms</h6>
              @Html.Action("_ShowSubplatform", "Subplatform")
            </div>
          </div>
          <div style="margin: 10px 0;" class="masonry-item col-lg-6 col-md-12">
            <div class="bgc-white p-20 bd" style="min-height: 765px;">
              <h6 style="margin-bottom: 25px" class="h6">Change Homepage</h6>
              @Html.Action("_ChangeHomePage", "Subplatform")
            </div>
          </div>

          <div style="margin: 10px 0;" class="masonry-item col-lg-6 col-md-12">
            <div class="bgc-white p-20 bd" style="min-height: 765px;">
              <h6 style="margin-bottom: 25px" class="h6">Change menu</h6>
              <div class="form-group row">


                <div class="row w-100">
                  <div class="col-5" style="padding: 0; margin:0;">
                    <label for="menu" class="col-form-label-sm">
                      Menu Item
                    </label>
                    <select id="menu" class="form-control">
                      <option>Kies menu item...</option>
                    </select>
                  </div>
                  <div class="col-5">
                    <label for="text" style="display:none" id="labeltext" class="col-form-label-sm">
                      Menu text
                    </label>
                    <textarea class="form-control" style="display:none;" id="text" rows="1">

                    </textarea>
                  </div>
                  <br />
                  <div class="col-2" style=" display: flex; align-items: center; justify-content: center; padding-top:10px;">
                    <label style="visibility:hidden" id="" class="col-form-label-sm">

                    </label>
                    <button id="btnSave" class="btn btn-primary btn-lg mT-10">Save</button>
                  </div>
                </div>

              </div>

              <h6 style="margin-bottom: 25px" class="h6">Change FAQ</h6>

              <div class="form-group row">


                <div class="row w-100">

                  <select id="FAQ" class="form-control">
                    <option>Kies FAQ item...</option>
                  </select>


                  <label for="vraag" class="col-form-label-sm">
                    Vraag
                  </label>
                  <textarea class="form-control" id="vraag" rows="2">

                    </textarea>
                  <br />
                  <label for="antwoord" class="col-form-label-sm">
                    Antwoord
                  </label>
                  <textarea class="form-control" id="antwoord" rows="2">

                    </textarea>


                  <button id="btnChange" class="btn btn-primary btn-sm mT-10">Save</button>
                </div>


              </div>

              <h6 style="margin-bottom: 25px" class="h6">Add FAQ</h6>
              <div class="form-group row">


                <div class="row w-100">

                  <label for="newvraag" class="col-form-label-sm">
                    Vraag
                  </label>
                  <textarea class="form-control" id="newvraag" rows="2">

                    </textarea>
                  <br />
                  <label for="newantwoord" class="col-form-label-sm">
                    Vraag
                  </label>
                  <textarea class="form-control" id="newantwoord" rows="2">

                    </textarea>

                  <br />
                  <button id="btnAdd" class="btn btn-primary btn-sm mT-10">Add</button>
                </div>


              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>

</main>
<script>

  $("#btnChange").click(function () {
    const faqChange = { FAQitem: $("#FAQ option:selected").text(), Question: $("#vraag").val(), Answer: $("#antwoord").val(), Subplatform: "@ViewBag.Subplatform"};
    console.log("GERAAKT");
    $.ajax({
      url: "http://localhost:51379/api/subplatform/ChangeTagFAQ",
      type: "POST",
      data: JSON.stringify(faqChange),
      headers: { 'x-api-key': '303d22a4-402b-4d3c-b279-9e81c0480711' },
      contentType: 'application/json'


    });
  });



  $("#btnSave").click(function () {
    const menu = { MenuItem: $("#menu option:selected").text(), MenuText: $("#text").val(), Subplatform: "@ViewBag.Subplatform"};
    console.log("GERAAKT");
    $.ajax({

      url: "http://localhost:51379/api/subplatform/ChangeTagMenu",
      type: "POST",
      data: JSON.stringify(menu),
      headers: { 'x-api-key': '303d22a4-402b-4d3c-b279-9e81c0480711' },
      contentType: 'application/json'

    });
  });


  $("#btnAdd").click(function () {
    const FAQ = { Question: $("#newvraag").val(), Answer: $("#newantwoord").val(), Subplatform: "@ViewBag.Subplatform"};
    console.log("GERAAKT");
    $.ajax({

      url: "http://localhost:51379/api/subplatform/AddQuestion",
      type: "POST",
      data: JSON.stringify(FAQ),
      headers: { 'x-api-key': '303d22a4-402b-4d3c-b279-9e81c0480711' },
      contentType: 'application/json'

    });
  });
  function tagMenu() {
    var tmp = "";

    tmp = $.ajax({
      async: false,
      type: 'GET',
      dataType: 'json',
      headers: { 'x-api-key': '303d22a4-402b-4d3c-b279-9e81c0480711' },
      url: "http://localhost:51379/api/subplatform/GetTagsOfMenu/" + "@ViewBag.SubplatformId"
    }).responseJSON;

    keys = Object.keys(tmp);
    var label = [];
    var values = [];

    for (var i = 0; i < keys.length; i++) {
      label.push(keys[i]);
      values.push(tmp[keys[i]]);
    }
    for (var i = 0; i < label.length; i++) {
      $("#menu").append($("<option></option>").val(i).html(label[i]));
    }


    $("#menu").change(function () {
      var str = null;
      str = $("#menu").val();
      $("#text").val(values[str]);
      $("#labeltext").show();
      $("#text").show();
    });
  }

  tagMenu();
  function tagFAQ() {
    var tmp = "";

    tmp = $.ajax({
      async: false,
      type: 'GET',
      dataType: 'json',
      headers: { 'x-api-key': '303d22a4-402b-4d3c-b279-9e81c0480711' },
      url: "http://localhost:51379/api/subplatform/GetTagsFaq/2"
    }).responseJSON;


    keys = Object.keys(tmp);
    var label = [];
    var text1 = [];
    var text2 = []

    for (var i = 0; i < keys.length; i++) {
      label.push(keys[i]);
      text1.push(Object.keys((tmp[keys[i]])));
      text2.push(tmp[keys[i]][text1[i]]);
    }
    console.log(label);
    console.log(text1);
    console.log(text2);
    for (var i = 0; i < label.length; i++) {
      $("#FAQ").append($("<option></option>").val(i).html(label[i]));
    }


    $("#FAQ").change(function () {
      var str = null;
      str = $("#FAQ").val();
      console.log(str);
      console.log(text1[str]);
      $("#vraag").val(text1[str]);
      $("#antwoord").val(text2[str]);

    });
  }
  tagFAQ();

  $(document).ready(function ($) {

    // Upload btn on change call function
    $(".uploadlogo1").change(function () {
      var filename = readURL(this);
      var name = filename.substring(filename.indexOf(".") + 1);
      $(this).parent().children('span').html(filename);
    });

    $(".uploadlogo2").change(function () {
      var filename = readURL(this);
      var name = filename.substring(filename.indexOf(".") + 1);


      $(this).parent().children('span').html(filename);
    });

    $(".uploadlogo3").change(function () {
      var filename = readURL(this);
      var name = filename.substring(filename.indexOf(".") + 1);

      console.log(name);
      $(this).parent().children('span').html(filename);
    });

    // Read File and return value
    function readURL(input) {
      var url = input.value;

      var ext = url.substring(url.lastIndexOf('.') + 1).toLowerCase();
      if (input.files &&
        input.files[0] &&
        (
          ext == "png" || ext == "jpeg" || ext == "jpg" || ext == "gif"
        )) {
        var path = $(input).val();
        var filename = path.replace(/^.*\\/, "");
        // $('.fileUpload span').html('Uploaded Proof : ' + filename);
        return "Uploaded file : " + filename;
      } else {
        $(input).val("");
        return "Only image formats are allowed!";
      }
    }
    // Upload btn end

  });
</script>